3:I[244,["56","static/chunks/56-4ca225befcc1e384.js","931","static/chunks/app/page-48cbdd1670ade9b0.js"],"default"]
6:I[1425,["56","static/chunks/56-4ca225befcc1e384.js","640","static/chunks/640-c43a5c3a291b9b6a.js","185","static/chunks/app/layout-7fe09417d88a24c2.js"],"default"]
7:I[9275,[],""]
8:I[1343,[],""]
9:I[685,["56","static/chunks/56-4ca225befcc1e384.js","640","static/chunks/640-c43a5c3a291b9b6a.js","185","static/chunks/app/layout-7fe09417d88a24c2.js"],"default"]
2:T518,M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z4:T26f9,
![Picture of my server rack](/assets/blog/homelab/cover.jpg)
*My server rack containing the firewall, switch and servers*

## Why selfhosting?
In an era where more and more personal information is being stored in the cloud, and with cloud providers like Google and others actively profiting from that information, 
it’s important to try to keep as much of that personal data private and "in-house" (literally, in this case).

By storing that much personal data and using services (such as email) through these providers, you also give up control of your digital presence to these companies. 
What if a bot at Google decides that your online activity is undesirable and closes your Google account, including your Gmail? In an instant, 
you could lose access to any accounts linked to that email and be left at the mercy of Google to recover your account.

Aside from addressing privacy concerns, self-hosting is also a fun way to learn more about how networks, app deployment, and internet security work—an added bonus in my view.

## In the beginning
When I first started my self-hosting journey, I only had a Raspberry Pi 4 with a couple of external HDDs attached to serve some media files. 
Soon, I outgrew the computational limitations of the Pi and decided to upgrade to a self-built system in a [Fractal Node 304](https://www.fractal-design.com/products/cases/node/node-304/black/), 
which is actually a great case for a home server if you don't want or don't have space for a rack. 
It has space for six (!) HDDs in an ITX form factor, and I installed an Intel i3-10300T, which is powerful enough to handle media transcoding using its Intel UHD Graphics 630 chip, while having a max TDP (thermal design power) of just 35W.

At first, I mainly used it for serving media (movies and shows) to my various devices using [Jellyfin](https://jellyfin.org/). 
To move away from online cloud storage from Google, I deployed an instance of [Nextcloud](https://nextcloud.com/) (which I'm now considering moving away from, as it’s too bloated), 
which also hosted my calendar and contacts book before I migrated that functionality to [BaïkalDAV](https://sabre.io/baikal/) (a lightweight CalDAV and CardDAV server).

### Network expansion
While doing all of this, I was still using my ISP’s default router, which had some features like port forwarding and a simple firewall, but lacked the advanced features I needed as the complexity of my network grew. 
Some things that were missing included VLAN support and more granular control over firewall rules.

I settled on a [Protectli FW4B](https://eu.protectli.com/product/fw4b/) and installed [OPNsense](https://opnsense.org/) on it, which is an open source fork of pfSense.
You could probably get a cheaper box to run your firewall, but since this was my first network hardware expansion, I wanted to play it safe rather than opting for an unbranded, Chinese-manufactured box.

Because "normal" _dumb_ switches don't have VLAN support, I bought a [Cisco Series 350 managed switch](https://www.cisco.com/c/en/us/support/switches/350-series-managed-switches/series.html) to replace a TP-Link 8 port switch I had. 
WWhile having 24 ports and supporting all the advanced features I needed, it was still small enough to fit in my past "network shelf" (AKA Ikea Kallax), but it also had a 19-inch rack mount for proper rack installation.

Leveraging the new firewall and switch I seperated my network in multiple VLAN's;
- A DMZ for the externally exposed server using port-forward
- An "internal" DMZ for the internal server
- "Main" VLAN for trusted devices like my PC and phone
- IOT VLAN with no internet access to stop devices from "talking home"

Because devices in the DMZ don’t have access to any other devices on the network, this adds an extra layer of security in case of a compromised machine. 
The same rule is applied to the IoT VLAN, as these smart devices run on manufacturers' firmware, over which I have no control in terms of safety and potential backdoors.

## Exposing services to the internet
Replacing cloud services with local applications that are not accessible from the internet defeats the purpose of a Cloud. 
Therefore, the applications running in Docker containers on the external-facing server (in the DMZ) are exposed to the outside world via a reverse proxy, with additional security measures in place.
I also have applications hosted on another internal server, but because these are not exposed to the internet they are not referenced in this post.

![Flow of exposing services to the internet](/assets/blog/homelab/network_flow.png)

#### Reverse proxy
One of the main challenges of exposing multiple applications in Docker containers to the internet is that you can only forward one port 80 (HTTP) and one port 443 (HTTPS) from your router or firewall. 
A possible workaround is to assign each container a different port (e.g., one on port 80 and another on port 8080), but this approach quickly becomes cumbersome.
In this case, you would need to access the non-default HTTP/HTTPS containers using a URL like _domain.com:8080_, but it becomes difficult to remember the port number for each application quickly.

To fix this problem, I use reverse proxy called [Traefik](https://doc.traefik.io/traefik/), which provides a single point of entry on specified port(s). In my case this is only port 443 (HTTPS) to ensure all incoming traffic is secure.
With Traefik, you can set labels to route specific subdomains to each container, for example the subdomain _cloud.domain.com_ routes to the Nextcloud container, and _media.domain.com_ routes to the Jellyfin instance.

Exposing containers only through a reverse proxy ensures better scalability and security. 
If I have a new app to deploy and expose, I only need to spin up a new container with the appropriate [Traefik labels](https://doc.traefik.io/traefik/reference/dynamic-configuration/docker/), 
and everything is good to go—aside from adding the corresponding subdomain to my domain's DNS records. 
From a security perspective, this approach is a step up from exposing individual Docker containers, as the reverse proxy provides a single point of entry. 
From there, I can log all traffic, ban specific IPs attempting to brute-force anything (using fail2ban), and enable HTTPS with Cloudflare using automatic Let's Encrypt (ACME) certificates.

#### Single Sign-On
While some applications have their own authentication mechanisms, including features like 2FA, this is not always the case. 
Storing and remembering the passwords for each individual account can also become cumbersome, although modern password managers help alleviate this by offering features like auto-filling.

To simplify authentication, I use [Authentik](https://goauthentik.io/) to provide a single account for nearly all the applications I host. 
Authentik allows me to add an authentication layer in front of my deployed apps using the same labeling system as Traefik, ensuring seamless integration.

For example, when I navigate to media.domain.com, Traefik first redirects me to Authentik on auth.domain.com to check if I'm logged in. 
If I am, it redirects me back; if not, it prompts me for my credentials. Authentik supports Role-Based Access Control (RBAC), allowing me to restrict access to certain apps based on the user's assigned group. 
It can also enforce 2FA during login, enhancing security compared to many default authentication mechanisms used by apps.

In addition to providing authentication in front of other apps, Authentik can serve as an Identity Provider (IdP) for apps, using so-called [_Providers_](https://docs.goauthentik.io/docs/providers). 
For instance, Nextcloud, which has its own mobile app, can't rely on a standard redirect for authentication due to its mobile nature. 
However, Nextcloud can be configured to use an external LDAP or OAuth2 Identity Provider, which Authentik can provide.

#### Firewall and Cloudflare
The last link in this entire chain is exposing the endpoints (in this case, port 443) to the World Wide Web, so they can be accessed from the internet. 
Factors to consider include security and continuity. I don’t want bad actors to be able to brute-force any services or launch a DDoS attack on my home network to take down my servers (and internet connection).

To mitigate this, I use [Cloudflare](https://www.cloudflare.com/)  as a proxy between my IP and the internet. 
Instead of requests going directly to my IP, they first go through Cloudflare, which hides my IP address and provides additional features like DDoS protection.

The firewall forwards all HTTPS traffic to the external server on the DMZ interface and is configured to drop connections coming from non-Cloudflare IPs. 
This ensures that all incoming traffic is originating from the Cloudflare proxy.

Since I’m located in The Netherlands and only access my server from other countries via VPN, 
I’ve geo-blocked all countries except for my own through Cloudflare. 
The chance of a request coming from China or Russia being legitimate is virtually zero, which helps prevent much of the bot spam originating from those regions.

## Concluding
In summary, self-hosting offers greater control over your data and privacy while allowing you to build and manage your own digital infrastructure. 
It’s a practical way to move away from reliance on third-party services, and it provides the flexibility to customize your setup to fit your needs. 
Whether you're looking for better security, learning opportunities, or just want more control, self-hosting can be a solid choice.

### Links
- PC/NAS case: [Fractal Node 304](https://www.fractal-design.com/products/cases/node/node-304/black/)
- OPNsense box: [Protectli FW4B](https://eu.protectli.com/product/fw4b/)
- Firewall software: [OPNsense](https://opnsense.org/)
- Reverse proxy: [Traefik](https://doc.traefik.io/traefik/)
- Single Sign-On: [Authentik](https://goauthentik.io/)5:T792,
![Website preview](/assets/blog/gilianeverink.nl/preview.png)

A friend of mine approached me with the question if I could make a simple minimalist website for him to replace his default namecheap parking page. 
His domain is generally only used to host mail but some more technological knowledgeable people might try to browse to [gilianeverink.nl](https://gilianeverink.nl) when handing them your email adress.

I made a simple one-page design with React+Typescript+Vite using `yarn create vite`.  Instead of CSS I like to use SCSS so I can nest styles and use variables.
The site features a single CSS media query for a correct display on mobile phones.

### Deployment
Because hosting costs money and I like to be cheap the site is hosted on [github pages](https://pages.github.com/).
The only problem with this is that my own site (this site) is also hosted here and Namecheap DNS doesn't like it when you use a path in your CNAME record.
This is needed because my own site is already pointing to [stenterstal.github.io](https://stenterstal.github.io) and we have to point the site to [stenterstal.github.io/gilianeverink.nl/](https://stenterstal.github.io/gilianeverink.nl/).

To solve this there are basically 2 options. Make a Github account for Gilian so we can point the Namecheap CNAME record to `gilianeverink.github.io` or make a Cloudflare account (Cloudflare does enable you to use a path in your CNAME record)

I went with making him a Cloudflare account instead of the Github account route. Using Cloudflare gives a couple nice benefits like automatic HTTPS rewrites, caching and DDOS protection. All while being free.
With the site still being hosted on my own Github account and repo I can still easily push new updates of the site without Gilian needing me to give access to a repo on his account.

### Links
- [Gilianeverink.nl](https://gilianeverink.nl)
- [Git repo](https://github.com/stenterstal/gilianeverink.nl)0:["g4aevI2l-yiO4TDLEN2BN",[[["",{"children":["__PAGE__",{}]},"$undefined","$undefined",true],["",{"children":["__PAGE__",{},[["$L1",[["$","section",null,{"className":"landing","children":["$","div",null,{"children":[["$","h1",null,{"children":"Sten"}],["$","h3",null,{"children":"Software Engineer"}],["$","p",null,{"children":[["$","i",null,{"children":"Full stack"}]," - with a preference for frontend"]}],["$","p",null,{"children":"Professionally a full stack developer, a hobbyist while at home. In my spare time I like to walk with my dog, read, play video games and experiment with technology. Beside programming I also have an interest in self hosting open source applications and creating a privacy friendly smart home/network."}],["$","div",null,{"className":"socials","children":[["$","a",null,{"href":"https://linkedin.com/in/stenterstal","children":[["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fab","data-icon":"linkedin-in","className":"svg-inline--fa fa-linkedin-in icon","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 448 512","style":{},"children":["$","path",null,{"fill":"currentColor","d":"M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z","style":{}}]}],["$","span",null,{"children":"LinkedIn"}]]}],["$","a",null,{"href":"https://github.com/stenterstal","children":[["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fab","data-icon":"github","className":"svg-inline--fa fa-github icon","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 496 512","style":{},"children":["$","path",null,{"fill":"currentColor","d":"$2","style":{}}]}],"Github"]}],["$","a",null,{"href":"mailto:mail@stenterstal.com","children":[["$","svg",null,{"aria-hidden":"true","focusable":"false","data-prefix":"fas","data-icon":"envelope","className":"svg-inline--fa fa-envelope icon","role":"img","xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 512 512","style":{},"children":["$","path",null,{"fill":"currentColor","d":"M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48L48 64zM0 176L0 384c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-208L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z","style":{}}]}],"Email"]}]]}]]}]}],["$","section",null,{"className":"projects","children":[["$","header",null,{"children":[["$","h2",null,{"children":["Projects (",2,")"]}],false]}],["$","div",null,{"className":"projects-container","children":[["$","$L3","homelab",{"project":{"published":true,"title":"Home server self-hosting","excerpt":"Short overview of the why and how of my server rack and the applications hosted on it, giving back control of data and privacy while also providing a good learning experience.","thumbnail":"/assets/blog/homelab/thumbnail.jpg","date":"25-10-2024","ogImage":{"url":"/assets/blog/homelab/thumbnail.jpg"},"tags":["home lab","docker"],"slug":"homelab","content":"$4"}}],["$","$L3","gilianeverink",{"project":{"published":true,"title":"Gilianeverink.nl","excerpt":"Minimalist personal website build for a friend using React, Typescript and NextJS. Hosted as a static SPA on Github Pages","thumbnail":"/assets/blog/gilianeverink.nl/thumbnail.png","date":"05-08-2024","ogImage":{"url":"/assets/blog/gilianeverink.nl/thumbnail.png"},"tags":["webdev","react"],"slug":"gilianeverink","content":"$5"}}]]}],false]}],["$","section",null,{"className":"experience","children":[["$","h2",null,{"children":"Experience & Education"}],["$","div",null,{"className":"CardRow","children":[["$","h3",null,{"children":["Software Engineer"," - ","Justid"]}],["$","p",null,{"className":"subtitle","children":["Work"," between ","nov 2022 - present"]}],["$","div",null,{"className":"content","children":[["$","p",null,{"children":["During my Graduation project I did research on how to migrate an existing server-side MVC application to JustitieConnect (Javascript SPA platform). I implemented this as a Proof of Concept with React as frontend and Django Rest Framework as backend",["$","br",null,{}],["$","br",null,{}]]}],["$","p",null,{"children":["During my actual work I am responsible for building and maintaining various applications called the Justice Service Interface (JSI), a platform/framework to support exchanging information in the judicial chain. I'm  also responsible for deploying and maintaining an in-house version of ",["$","a",null,{"target":"_blank","href":"https://developer.overheid.nl","children":"the open source developer.overheid.nl project"}]," for use in the Justice department to promote the use of API's to exchange information."]}]]}],["$","ul",null,{"className":"tags","children":[["$","li","Angular-0",{"children":"Angular"}],["$","li","Python-1",{"children":"Python"}],["$","li","Django-2",{"children":"Django"}],["$","li","Kubernetes-3",{"children":"Kubernetes"}],["$","li","Jenkins-4",{"children":"Jenkins"}],["$","li","Docker-5",{"children":"Docker"}]]}]]}],["$","div",null,{"className":"CardRow","children":[["$","h3",null,{"children":["Internship & Student Job Frontend Developer"," - ","Fortes"]}],["$","p",null,{"className":"subtitle","children":["Work"," between ","feb 2021 - nov 2021"]}],["$","div",null,{"className":"content","children":[["$","p",null,{"children":"During my internship made user configurable graphical segments to be used inside the Fortes Change Cloud."}],["$","p",null,{"children":"Stayed after my internship and worked with the scrum development team on new features and bugfixes"}]]}],["$","ul",null,{"className":"tags","children":[["$","li","React-0",{"children":"React"}],["$","li","Backbone.js-1",{"children":"Backbone.js"}]]}]]}],["$","div",null,{"className":"CardRow","children":[["$","h3",null,{"children":["HBO-ICT"," - ","Saxion Enschede"]}],["$","p",null,{"className":"subtitle","children":["Education"," between ","2018 - 2023"]}],["$","div",null,{"className":"content","children":["$","ul",null,{"children":[["$","li",null,{"children":["Specialization Advanced Application Development - ",["$","i",null,{"children":"Rapid prototyping, UI/UX"}]]}],["$","li",null,{"children":["Minor Smart Cities - ",["$","i",null,{"children":"Multidisciplinary collaboration between IT and Spatial Development"}]]}]]}]}],["$","ul",null,{"className":"tags","children":"$undefined"}]]}]]}]]],null],null]},[["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","meta",null,{"name":"theme-color","content":"#000"}],["$","link",null,{"rel":"icon","type":"image/svg+xml","href":"/favicon/icon.png"}],["$","link",null,{"rel":"alternate","type":"application/rss+xml","href":"/feed.xml"}]]}],["$","body",null,{"children":[["$","$L6",null,{}],["$","main",null,{"children":[["$","div",null,{"className":"main-container","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L8",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4d636543fac3a0db.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/f4cafce6173776ae.css","precedence":"next","crossOrigin":"$undefined"}]]}]}],["$","$L9",null,{}]]}]]}]]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/777e41119fcc118c.css","precedence":"next","crossOrigin":"$undefined"}]],[null,"$La"]]]]]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Sten ter Stal | Full Stack Software Engineer"}],["$","meta","3",{"name":"description","content":"Online resume and collection of projects"}],["$","meta","4",{"property":"og:title","content":"Sten ter Stal | Full Stack Software Engineer"}],["$","meta","5",{"property":"og:description","content":"Online resume and collection of projects"}],["$","meta","6",{"property":"og:locale","content":"en_US"}],["$","meta","7",{"property":"og:image","content":"https://stenterstal.com/assets/img/Avatar.png"}],["$","meta","8",{"property":"og:image:alt","content":"Pixelated avatar"}],["$","meta","9",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","10",{"name":"twitter:title","content":"Sten ter Stal | Full Stack Software Engineer"}],["$","meta","11",{"name":"twitter:description","content":"Online resume and collection of projects"}],["$","meta","12",{"name":"twitter:image","content":"https://stenterstal.com/assets/img/Avatar.png"}],["$","meta","13",{"name":"twitter:image:alt","content":"Pixelated avatar"}]]
1:null
